flowchart TD
  %% Client
  subgraph Client["Client"]
    U[Service Writer Browser] --> FE[OBDscribe Web App]
  end

  %% Frontend
  subgraph Frontend["Frontend (Next.js + TypeScript + Tailwind)"]
    FE --> PLogin["/login"]
    FE --> PNew["/app/new-report"]
    FE --> PHistory["/app/history (later)"]
    FE --> PSettings["/app/settings (later)"]

    PNew --> FRForm["New Report Form"]
    PNew --> FROutput["Report Output View"]
  end

  %% API Routes
  subgraph API["API Routes"]
    FRForm --> APIGen["/api/generate-report"]
    PLogin --> APIAuth["/api/auth/login"]
    FE --> APIHealth["/api/health"]
    PHistory --> APIReports["/api/reports (later)"]
    PSettings --> APISettings["/api/settings (later)"]
  end

  %% Backend and DB
  subgraph Backend["Backend and DB"]
    APIGen --> RateLimiter["Rate Limiter"]
    RateLimiter --> AIEngine["ai-engine module"]

    APIReports --> DB[(Postgres DB)]
    APISettings --> DB
    APIAuth --> DB
  end

  %% AI Engine
  subgraph AI["AI Engine (OpenAI)"]
    AIEngine --> Prompt["Prompt Builder (prompt_version, mode)"]
    Prompt --> OA["OpenAI Reasoning Model"]

    %% Note: Tools are future phases, not v0
    OA --> PostProc["Post Processor and JSON Validation"]
  end

  PostProc --> DB
  PostProc --> APIGen

  %% Data and Logs
  subgraph Data["Data and Storage"]
    DB[(Postgres DB)]
    Logs["Log Storage"]
  end

  APIGen --> DB
  APIGen --> Logs

  %% External Services (future)
  subgraph External["External Services (later phases)"]
    VINAPI["VIN Decoder API (later)"]
    PartsAPI["Labor/Parts APIs (later)"]
  end